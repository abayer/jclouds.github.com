<h1>Using jClouds with Apache Maven</h1>

<h2>Introduction</h2>

<p>To obtain jclouds artifacts you need to define the repository, as well as the specific packages you need:</p>

<h2>Environment Variables</h2>

<ul><li>JAVA_HOME : You must use a recent version of java 6 in order to use jclouds.</li>
<li>M2_HOME : jclouds requires Apache Maven 3.0.2 or higher</li>
<li>MAVEN_OPTS : Some of jclouds tests are heavyweight, as they launch many threads and attempt concurrent activity.<br />
  Default JVM parameters will not work, if you attempt to run <code>mvn install</code> from the root of jclouds directory.<br />
  Please use the following to setup your environment appropriate to execute.

<ul><li>Windows 32 bit JDK
<code>set MAVEN_OPTS=-Xmn128m -Xms256m -Xmx256m -XX:PermSize=64m -XX:MaxPermSize=64m -Xss1024k</code></li>
<li>Non-Windows 64-bit JDK
<code>export MAVEN_OPTS="-Xms128m -Xmx256m"</code></li>
</ul></li>
</ul><h2>Provider Credentials</h2>

<p>Provider Credentials are required to run tests that connect to services such as BlobStore or ComputeService.<br />
Please add a <a href="http://maven.apache.org/guides/introduction/introduction-to-profiles.html">maven profile</a> to settings.xml
so that your credentials can be used for integration tests:</p>

<pre><code>&lt;profile&gt;
  &lt;id&gt;provider&lt;/id&gt;
  &lt;activation&gt;
    &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
  &lt;/activation&gt;
  &lt;properties&gt;
    &lt;test.provider.identity&gt;account,user,apikey,etc&lt;/test.provider.identity&gt;
    &lt;test.provider.credential&gt;password,secret,etc&lt;/test.provider.credential&gt;
  &lt;/properties&gt;
&lt;/profile&gt;</code></pre>

<p>Here is an example of a complete <em>settings.xml</em> file you can save to the ~/.m2 directory, just remember to add your personal credentials:</p>

<pre><code>&lt;settings&gt;
  &lt;profiles&gt;
    &lt;profile&gt;
      &lt;id&gt;provider&lt;/id&gt;
      &lt;activation&gt;
        &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
      &lt;/activation&gt;
      &lt;properties&gt;
        &lt;test.aws.identity&gt;123908109d&lt;/test.aws.identity&gt;
        &lt;test.aws.crendential&gt;SDAIFJASKL9uiojfd&lt;/test.aws.crendential&gt;
        &lt;test.trmk-vcloudexpress.identity&gt;adrian@jclouds.org&lt;/test.trmk-vcloudexpress.identity&gt;
        &lt;test.trmk-vcloudexpress.credential&gt;veggieBurgersInParadise&lt;/test.trmk-vcloudexpress.credential&gt;
      &lt;/properties&gt;
    &lt;/profile&gt;
  &lt;/profiles&gt;
&lt;/settings&gt;</code></pre>

<h2>SSH Credentials</h2>

<p>SSH Credentials are required to run tests for SSH extensions.<br />
Please add a <a href="http://maven.apache.org/guides/introduction/introduction-to-profiles.html">maven profile</a> to settings.xml
so that your credentials can be used for integration tests:</p>

<pre><code>&lt;profile&gt;
  &lt;id&gt;ssh&lt;/id&gt;
  &lt;activation&gt;
    &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
  &lt;/activation&gt;
  &lt;properties&gt;
     &lt;test.ssh.keyfile&gt;PATH_TO/id_rsa&lt;/test.ssh.keyfile&gt;
    &lt;test.ssh.username&gt;LOCAL_SSH_ID&lt;/test.ssh.username&gt;
    &lt;test.ssh.password&gt;LOCAL_SSH_PASSWORD&lt;/test.ssh.password&gt;
  &lt;/properties&gt;
&lt;/profile&gt;</code></pre>

<p>Here is an example of a complete <em>settings.xml</em> file you can save to the ~/.m2 directory, just remember to change the ssh credentials:</p>

<pre><code>&lt;settings&gt;
  &lt;profiles&gt;
    &lt;profile&gt;
      &lt;id&gt;ssh&lt;/id&gt;
      &lt;activation&gt;
        &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
      &lt;/activation&gt;
      &lt;properties&gt;
        &lt;test.ssh.username&gt;nobody&lt;/test.ssh.username&gt;
        &lt;test.ssh.password&gt;asdf&lt;/test.ssh.password&gt;
      &lt;/properties&gt;
    &lt;/profile&gt;
  &lt;/profiles&gt;
&lt;/settings&gt;</code></pre>

<h2>Dependencies</h2>

<p>Depending on what you want to do, you may need different dependencies.</p>

<h3>BlobStore</h3>

<p>This assumes you are only interested in Basic BlobStore commands, like below:</p>

<pre><code>BlobStoreContext context = new BlobStoreContextFactory().createContext(provider, identity, credential);
Map&lt;String, InputStream&gt; map = context.createInputStreamMap("adrian.home");
  // do work
context.close();</code></pre>

<p>This also assumes that you do not have heavy-duty needs that warrant connection-pooling or NIO,
or that you are in an environment that cannot use them.</p>

<p>In this case, you only need to add the following to your project's dependencies:
</p><pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.jclouds&lt;/groupId&gt;
    &lt;artifactId&gt;jclouds-blobstore&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
Using the above, you will gain access to the provider named <code>transient</code>.  Note that this is in-memory.  Typically, you will instead want to add dependencies on a specific provider of resources like those for S3:

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.jclouds.provider&lt;/groupId&gt;
    &lt;artifactId&gt;aws-s3&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre>

<p>Noting that you could alternatively ask for all of our supported blobstores using the dependency <code>jclouds-allblobstore</code> instead.</p>

<p>Then, you'd substitute the correct credentials and such here:
</p><pre><code>BlobStoreContext context = new BlobStoreContextFactory().createContext("aws-s3", accessKey, secret);</code></pre>

<h3>Non-Blocking BlobStore</h3>

<p>There is no change to the api, in order to switch your code to use ning.
 However, you do have to configure your connection differently:
</p><pre><code>BlobStoreContext context = new BlobStoreContextFactory().createContext(provider, identity, credential,
 											ImmutableSet.&lt;Module&gt;of(new NingHttpCommandExecutorServiceModule()));</code></pre>

<p>Here are the dependencies for pooled connections and non-blocking io:</p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.jclouds&lt;/groupId&gt;
    &lt;artifactId&gt;jclouds-blobstore&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.jclouds&lt;/groupId&gt;
    &lt;artifactId&gt;jclouds-ning&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</code></pre>

<h3>BlobStore from Google App Engine</h3>

<p>There is no change to the api, in order to switch your code to use <code>URLFetchService</code> from within GAE.<br />
However, you do have to configure your connection differently:</p>

<pre><code>BlobStoreContext context = new BlobStoreContextFactory().createContext(provider, identity, credential, 
				ImmutableSet.&lt;Module&gt;of(new GoogleAppEngineConfigurationModule()));</code></pre>

<p>Here are the dependencies needed to use google's UrlFetchService::
</p><pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.jclouds&lt;/groupId&gt;
    &lt;artifactId&gt;jclouds-blobstore&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.jclouds&lt;/groupId&gt;
    &lt;artifactId&gt;jclouds-gae&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre>

<h2>Log4J</h2>

<p>jclouds-aws will by default use JDK logging.  To switch to log4J, you have to add a logging module to your configuration code:</p>

<pre><code>BlobStoreContext context = new BlobStoreContextFactory().createContext(provider, identity, credential, 
										ImmutableSet.&lt;Module&gt;of(new Log4JLoggingModule()));</code></pre>

<p>Here are the dependencies for BlobStore and log4j logging:</p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.jclouds&lt;/groupId&gt;
    &lt;artifactId&gt;jclouds-blobstore&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.jclouds&lt;/groupId&gt;
    &lt;artifactId&gt;jclouds-log4j&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre>

<p>The log categories are set to package names, so plan on assigning <code>org.jclouds</code> appropriately in your log4j.xml.</p>

<p><code>Last Updated: 2011-07-26</code></p>