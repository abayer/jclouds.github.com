<h1>Provider Medata in jclouds</h1>

<h2>Introduction</h2>

<p>Provider metadata in jclouds lets the provider implementor/maintainer to do two major things very easily:</p>

<ul><li>Describe the provider (Verbose name, documentation url, homepage url, console url, etc.)</li>
<li>Hook into a provider loading mechanism similar to a "plugin loader"</li>
</ul><p>The purpose for this document it to further explain how you can implement provider metadata for a provider.</p>

<h2>Implementing Provider Metadata</h2>

<p>Implementing provider metadata for a jclouds provider is a two step process.<br />
First you need to have an implementation class that will be loaded by the <a href="http://java.sun.com">Java</a>
<a href="http://download.oracle.com/javase/6/docs/api/java/util/ServiceLoader.html">ServiceLoader</a>.<br />
Next you need to create a "provider configuration file" that <code>ServiceLoader</code> can locate and use.
 We'll talk about the actual details below.</p>

<h2>Example Implementation Class</h2>

<p>The process for implementing provider metadata in jclouds is really simple.<br />
All you have to do is extend a concrete base class
 <a href="https://github.com/jclouds/jclouds/blob/master/core/src/main/java/org/jclouds/providers/BaseProviderMetadata.java">org.jclouds.providers.BaseProviderMetadata</a> which is in jclouds/core.<br />
This class is abstract class because it implements the
<a href="https://github.com/jclouds/jclouds/blob/master/core/src/main/java/org/jclouds/providers/ProviderMetadata.java">org.jclouds.providers.ProviderMetadata</a> interface yet the provider metadata implementor
is the one that should be implementing the <code>ProviderMetadata</code> interface methods.</p>

<p>The reason for this is Java's <code>ServiceLoader</code> requires an interface for its plugin system but for us to
do real object equality checks we needed a class to implement the equals/hashCode methods.</p>

<p>That being said, here is an example of implementing provider metadata for <a href="http://aws.amazon.com/">Amazon Elastic Compute Cloud (EC2)</a>
<a href="https://github.com/jclouds/jclouds/blob/master/providers/aws-ec2/src/main/java/org/jclouds/aws/ec2/AWSEC2ProviderMetadata.java">AWSEC2ProviderMetadata.java</a>:</p>

<pre><code>/**
 *
 * Copyright (C) 2011 Cloud Conscious, LLC. &lt;info@cloudconscious.com&gt;
 *
 * ====================================================================
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ====================================================================
 */
package org.jclouds.aws.ec2;

import com.google.common.collect.ImmutableSet;

import java.net.URI;
import java.util.Set;

import org.jclouds.providers.BaseProviderMetadata;
import org.jclouds.providers.ProviderMetadata;

/**
 * Implementation of {@ link org.jclouds.types.ProviderMetadata} for Amazon's
 * Elastic Compute Cloud (EC2) provider.
 *
 * @author Jeremy Whitlock &lt;jwhitlock@apache.org&gt;
 */
public class AWSEC2ProviderMetadata extends BaseProviderMetadata {

   /**
    * {@inheritDoc}
    */
   @Override
   public String getId() {
      return "aws-ec2";
   }

   /**
    * {@inheritDoc}
    */
   @Override
   public String getType() {
      return ProviderMetadata.COMPUTE_TYPE;
   }

   /**
    * {@inheritDoc}
    */
   @Override
   public String getName() {
      return "Amazon Elastic Compute Cloud (EC2)";
   }

   /**
    * {@inheritDoc}
    */
   @Override
   public String getIdentityName() {
      return "Access Key ID";
   }

   /**
    * {@inheritDoc}
    */
   @Override
   public String getCredentialName() {
      return "Secret Access Key";
   }

   /**
    * {@inheritDoc}
    */
   @Override
   public URI getHomepage() {
      return URI.create("http://aws.amazon.com/ec2/");
   }

   /**
    * {@inheritDoc}
    */
   @Override
   public URI getConsole() {
      return URI.create("https://console.aws.amazon.com/ec2/home");
   }
   /**
    * {@inheritDoc}
    */
   @Override
   public URI getApiDocumentation() {
      return URI.create("http://docs.amazonwebservices.com/AWSEC2/latest/APIReference");
   }

   /**
    * {@inheritDoc}
    */
   @Override
   public Set&lt;String&gt; getLinkedServices() {
      return ImmutableSet.of("aws-s3", "aws-ec2", "aws-elb", "aws-simpledb");
   }

   /**
    * {@inheritDoc}
    */
   @Override
   public Set&lt;String&gt; getIso3166Codes() {
      return ImmutableSet.of("US-VA", "US-CA", "IE", "SG", "JP-13");
   }

}</code></pre>

<p>The code above is pretty self-explanatory but if you want more details,
the <code>org.jclouds.provider.ProviderMetadata</code> has the actual javadocs that have more detail.<br />
Now that you have an example implementation class, let's look at how to create the service file.</p>

<h2>Example Provider Configuration File</h2>

<p>The <code>ServiceLoader</code>'s provider configuration file has two requirements:</p>

<ul><li>The location of the file is META-INF/services/</li>
<li>The contents of the file is a line-delimited list of fully-qualified binary names of the concrete classes</li>
</ul><p>In our example, we would end up with a provider configuration file of <em>META-INF/services/org.jclouds.providers.ProviderMetadata</em>
 with a single line in it looking like this:</p>

<pre><code>org.jclouds.aws.ec2.AWSEC2ProviderMetadata</code></pre>

<p>Now that we know how to implement provider metadata for jclouds providers, let's look at an example test for
the above provider to see how you might go about testing your provider metadata implementation.</p>

<h2>Example Provider Metadata Test</h2>

<p>Testing provider metadata in jclouds is very simple thanks to the <code>org.jclouds.providers.BaseProviderMetadata</code> class.
All you have to do is check for object equality to make sure the provider you expect to receive is the one the <code>ServiceLoader</code> is giving you.</p>

<p>Below is the <a href="https://github.com/jclouds/jclouds/blob/master/providers/aws-ec2/src/test/java/org/jclouds/aws/ec2/AWSEC2ProviderTest.java">org.jclouds.providers.AWSEC2ProviderTest.java</a>
class that tests the <code>org.jclouds.aws.ec2.AWSEC2ProviderMetadata</code> class:</p>

<pre><code>/**
 *
 * Copyright (C) 2011 Cloud Conscious, LLC. &lt;info@cloudconscious.com&gt;
 *
 * ====================================================================
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ====================================================================
 */
package org.jclouds.aws.ec2;

import org.jclouds.aws.ec2.AWSEC2ProviderMetadata;
import org.jclouds.providers.BaseProviderMetadataTest;
import org.jclouds.providers.ProviderMetadata;
import org.testng.annotations.Test;

/**
 * The AWSEC2ProviderTest tests the org.jclouds.aws.ec2.AWSEC2Provider class.
 * 
 * @author Jeremy Whitlock &lt;jwhitlock@apache.org&gt;
 */
@Test(groups = "unit", testName = "AWSEC2ProviderTest")
public class AWSEC2ProviderTest extends BaseProviderMetadataTest {

   public AWSEC2ProviderTest() {
      super(new AWSEC2ProviderMetadata(), ProviderMetadata.COMPUTE_TYPE);
   }
}</code></pre>

<p>Now that we know how to implement and test provider metadata, below is an example of why this might be useful to jclouds consumers.</p>

<h2>Usage Example</h2>

<p>The main user of provider metadata in previous discussions has been those building UIs/tools around jclouds.
 For example, imagine you wanted to let a user select a cloud provider out of the list jclouds supports.
With provider metadata, you can easily create a drop-down list of provider names that the user could select.<br />
You could also know the proper labels to display to the user when asking for their cloud provider credentials.</p>

<p>This is only one brief, high-level example but by understanding how to implement provider metadata, you should easily
see how this could be used in other ways.</p>

<p><code>Last Updated: Thu Jun  2 13:33:27 2011</code></p>